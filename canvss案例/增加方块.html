<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>碰撞回弹</title>
    <script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script>
</head>
<body>
    <button onclick="create()">新增方块</button>
    <canvas id="myCanvas" width="700" height="500" style="border: 1px solid red;"></canvas>
    <button onclick="status()">状态</button>
</body>

<script>   
    var playAnimation = true;
    var x = 0;
    var play = new Array();
    var test = 0;
    var canvas = $("#myCanvas"); 
    var context = canvas.get(0).getContext("2d"); 
    var canvasWidth = canvas.width(); 
    var canvasHeight = canvas.height(); 

    function animate() { 
        if(playAnimation){
            judge();
            draw();
            setTimeout(animate, 20); //用于在指定的毫秒数后调用函数或计算表达式。
            test++;
        }
    }; 
    animate();


    // 开关
    function status(){
        if(playAnimation){
            playAnimation = false;
        }
        else{
            playAnimation = true;
            animate();
        }
    }

    // 绘制正方形
    function draw(){
        context.clearRect(0, 0, canvasWidth, canvasHeight); //clearRect():清空画布
        for(var i=0;i<play.length;i++){
            play[i].x ++;

            if (!play[i].reverseX) { 
                play[i].x += 2; 
            } else { 
                play[i].x -= 2; 
            }; 
 
            if (!play[i].reverseY) { 
                play[i].y += 2; 
            } else { 
                play[i].y -= 2; 
            };

            context.fillRect(play[i].x, play[i].y, play[i].width, play[i].height);//绘制“已填色”的矩形
        }
    }

    // 新增正方形
    function create(){
        const y = Math.floor(Math.random()*500 - 50);
        const base = Math.floor(Math.random()*50 );
        play.push(new shape(0,y,base,base));
       
    }

    // 构造函数
    function shape(x,y,width,height){
        this.width = width;
        this.height = height;
        this.x = x;
        this.y = y;
        this.reverseX = true;
        this.reverseY = true;
    }

    // 判断方块是否碰撞
    function judge(){
        for(var i=0;i<play.length;i++){
            if(play[i].x<0){
                play[i].reverseX = false;
            }
            else if(play[i].x + play[i].width > canvasWidth){
                play[i].reverseX = true;
            }

            if(play[i].y<0){
                play[i].reverseY = false;
            }
            else if(play[i].y + play[i].height > canvasHeight){
                play[i].reverseY = true;
            }
        }
    }

</script>


</html>